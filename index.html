<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cotizador de Monturas</title>
  <meta name="description" content="Cotizador de monturas ecuestres con extras. Descarga tu cotización en PDF o comparte por WhatsApp." />
  <style>
    :root {
      --primary: #c2410c;
      --secondary: #f97316;
      --accent: #eab308;
      --bg: #fff7ed;
      --text: #1f2937;
      --muted: #6b7280;
      --card: #ffffff;
      --border: #f1e5d1;
      --danger: #dc2626;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial;
      background: linear-gradient(180deg, #fff7ed 0%, #ffedd5 35%, #fefce8 100%);
      color: var(--text); min-height: 100vh;
      display: flex; flex-direction: column;
    }
    .container { max-width: 1000px; margin: 0 auto; padding: 0 16px; width: 100%; }
    .site-header { background: linear-gradient(90deg, var(--primary), var(--secondary)); color: #fff; padding: 18px 0 10px; margin-bottom: 20px; }
    .site-header .brand { font-size: 1.4rem; font-weight: 900; display: flex; align-items: center; gap: 14px; }
    .site-header .brand .logo { background: #fff; color: var(--primary); width: 40px; height: 40px; display: grid; place-items: center; border-radius: 8px; font-size: 1.2em; font-weight: 900; }
    .site-header nav a { color: #fff; text-decoration: none; margin-left: 18px; font-weight: 600; }
    .site-header nav a:hover { text-decoration: underline; }
    main { flex: 1 0 auto; }
    .card { background: var(--card); border: 1px solid var(--border); border-radius: 14px; box-shadow: 0 3px 18px rgba(2, 6, 23, 0.08); margin-bottom: 18px; padding: 22px; }
    .card-header { font-size: 1.2rem; font-weight: 700; margin-bottom: 16px; }
    .field { margin-bottom: 14px; }
    .field label { font-weight: 700; display: block; margin-bottom: 6px; }
    .row { display: flex; gap: 14px; }
    .subgroup { background: #fafaf9; border: 1px dashed var(--border); border-radius: 10px; padding: 12px; }
    select, input[type="number"], input[type="text"] {
      padding: 9px 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 1rem; width: 100%;
      margin-bottom: 4px;
    }
    input[type="checkbox"], input[type="radio"] { accent-color: var(--primary); }
    .actions { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 18px; }
    .btn, .btn-outline {
      border-radius: 10px; padding: 12px 18px; font-weight: 800; cursor: pointer;
      transition: box-shadow 0.2s, transform 0.15s;
    }
    .btn { background: linear-gradient(90deg, #fef9c3, var(--accent)); border: 0; color: #0b1020; }
    .btn-outline { background: #fff; border: 1px solid var(--border); color: var(--muted); }
    .btn:hover, .btn-outline:hover { box-shadow: 0 6px 20px rgba(245,158,11,0.08); transform: translateY(-2px); }
    .total { font-size: 2rem; font-weight: 900; color: var(--primary); margin: 10px 0 6px;}
    .error { color: var(--danger); font-size: .96rem; background: #fee2e2; border: 1px solid #fecaca; border-radius: 8px; padding: 6px 10px; margin: 8px 0 0; display: none; }
    @media (max-width: 740px) { .row { flex-direction: column; } }
    .site-footer { background: #0b1020; color: #cbd5e1; padding: 20px 0; text-align: center; margin-top: 0; }
    .site-footer a { color: #e2e8f0;}
    .hint { color: var(--muted); font-size: .93rem; }
    ul.breakdown { list-style: none; padding: 0; margin: 6px 0 0; }
    ul.breakdown li { display: flex; align-items: center; justify-content: space-between; padding: 7px 0; border-bottom: 1px dashed var(--border); gap: 8px; }
    ul.breakdown li:last-child { border-bottom: 0; }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="container" style="display:flex;align-items:center;justify-content:space-between;">
      <div class="brand"><span class="logo">CM</span> Cotizador de Monturas</div>
      <nav>
        <a href="#montura">Montura</a>
        <a href="#extras">Extras</a>
        <a href="#total">Total</a>
      </nav>
    </div>
  </header>
  <main class="container">
    <form id="cotizadorForm" autocomplete="off">
      <div class="card" id="montura">
        <div class="card-header">Montura</div>
        <div class="field">
          <label for="fusteEstilo">Fuste - Estilo</label>
          <select id="fusteEstilo" name="fusteEstilo">
            <option value="saldivar">Saldívar</option>
            <option value="buchon">Buchón</option>
          </select>
        </div>
        <div class="field">
          <label for="medidaFuste">Fuste - Medida <span class="hint">(en pulgadas, ej: 14, 14.5, 15...)</span></label>
          <select id="medidaFuste" name="medidaFuste">
            <option value="13.5">-14</option>
            <option value="14">14</option>
            <option value="14.5">14.5</option>
            <option value="15">15</option>
            <option value="15.5">15.5</option>
            <option value="16">16</option>
            <option value="16.5">16.5</option>
            <option value="17">17</option>
            <option value="18">18</option>
          </select>
          <div id="medidaError" class="error"></div>
        </div>
        <div class="field">
          <label><input type="checkbox" id="clienteMandaFuste" name="clienteMandaFuste" /> El cliente envía su fuste <span class="hint">(-$1,000)</span></label>
        </div>
        <div class="field">
          <label for="cueraje">Cueraje</label>
          <select id="cueraje" name="cueraje">
            <option value="cantinas_redondas_basto_mediano">Cantinas redondas basto mediano</option>
            <option value="cantinas_cuadradas_basto_mediano">Cantinas cuadradas basto mediano</option>
            <option value="cantinas_redondas_basto_grande">Cantinas redondas basto grande</option>
            <option value="cantinas_cuadradas_basto_grande">Cantinas cuadradas basto grande</option>
            <option value="esqueleto_basto_cuadrado">Esqueleto basto cuadrado</option>
            <option value="esqueleto_cola_pato">Esqueleto cola de pato</option>
          </select>
        </div>
        <div class="field">
          <label>Arciones</label>
          <div class="row">
            <div>
              <label class="hint">Estilo</label>
              <label><input type="radio" name="arcEstilo" value="sencilla" checked /> Sencillas</label>
              <label><input type="radio" name="arcEstilo" value="doble" /> Dobles</label>
            </div>
            <div>
              <label class="hint">Tipo</label>
              <label><input type="radio" name="arcTipo" value="recta" checked /> Rectas</label>
              <label><input type="radio" name="arcTipo" value="sudadera" /> Sudadera</label>
            </div>
          </div>
          <div class="hint" id="arcTipoHint"></div>
        </div>
        <div class="field">
          <label for="herrajeEstilo">Herraje - Estilo</label>
          <select id="herrajeEstilo" name="herrajeEstilo">
            <option value="cuero">Cuero</option>
            <option value="cuerno_toro">Cuerno de toro (+$3,000)</option>
            <option value="inox_blanco">Acero inoxidable blanco (+$3,500)</option>
            <option value="inox_pavonado">Acero inoxidable pavonado (+$4,500)</option>
            <option value="fierro_aluminio">Fierro incrustado de aluminio (+$9,000)</option>
            <option value="fierro_plata">Fierro incrustado de plata (trabajo especial)</option>
          </select>
        </div>
        <div class="field">
          <label for="herrajeGreca">Herraje - Greca</label>
          <select id="herrajeGreca" name="herrajeGreca">
            <option value="L">L</option>
            <option value="T">T</option>
            <option value="Y">Y</option>
          </select>
        </div>
        <div class="field">
          <label><input type="checkbox" id="argollasTapa" name="argollasTapa" /> Argollas de tapa <span class="hint">(+ $1,000)</span></label>
          <div class="hint" id="argTapaHint"></div>
        </div>
        <div class="field">
          <label>Estribos</label>
          <label><input type="radio" name="estribos" value="abierto" checked /> Abierto (incluidos)</label>
          <label><input type="radio" name="estribos" value="tapadera" /> De tapadera (+$1,500)</label>
        </div>
      </div>
      <div class="card" id="extras">
        <div class="card-header">Extras y Textiles</div>
        <div class="field">
          <label>Carona</label>
          <select id="carona" name="carona">
            <option value="">No agregar</option>
            <option value="cola_pato">Cola de pato (+$800)</option>
            <option value="basto_cuadrado">Basto cuadrado (+$1,000)</option>
            <option value="redondas_basto_mediano">Redondas basto mediano (+$1,200)</option>
            <option value="cuadradas_basto_mediano">Cuadradas basto mediano (+$1,200)</option>
            <option value="redondas_basto_grande">Redondas basto grande (+$1,500)</option>
            <option value="cuadradas_basto_grande">Cuadradas basto grande (+$1,500)</option>
          </select>
        </div>
        <div class="field">
          <label>Zarape</label>
          <label><input type="radio" name="zarape" value="" checked /> Ninguno</label>
          <label><input type="radio" name="zarape" value="sencillo" /> Sencillo (+$900)</label>
          <label><input type="radio" name="zarape" value="fino" /> Fino (+$3,500)</label>
        </div>
        <div class="field">
          <label><input type="checkbox" id="cincha" name="cincha" /> Cincha (+$1,200)</label>
          <input type="number" id="cinchaMedida" name="cinchaMedida" placeholder="Medida en cm" min="30" max="200" style="max-width:140px;" />
        </div>
        <div class="field">
          <label><input type="checkbox" id="cuarta" name="cuarta" /> Cuarta estándar (+$500)</label>
        </div>
        <div class="field">
          <label><input type="checkbox" id="jaquima" name="jaquima" /> Jáquima / Bozalillo fino de faena (+$2,800)</label>
        </div>
        <div class="field">
          <label>Cinturón de piel cosido a mano (2") (+$900)</label>
          <input type="checkbox" id="cinturon" name="cinturon" />
          <input type="text" id="cinturonTalla" name="cinturonTalla" placeholder="Talla de pantalón (ej. 32)" style="max-width:130px;" />
          <div class="hint">No incluye hebilla, se cotiza aparte.</div>
        </div>
        <div class="field">
          <label>Extras que se cotizan por mensaje directo:</label>
          <label><input type="checkbox" id="hebilla" name="hebilla" /> Hebilla del cinturón</label>
          <label><input type="checkbox" id="espuelas" name="espuelas" /> Espuelas</label>
          <label><input type="checkbox" id="machete" name="machete" /> Machete</label>
          <label><input type="checkbox" id="freno" name="freno" /> Freno</label>
          <label><input type="checkbox" id="cuchillo" name="cuchillo" /> Cuchillo</label>
        </div>
      </div>
      <div class="card" id="total">
        <div class="card-header">Total</div>
        <div id="cotizacionResumen">
          <div class="total" id="precioTotal">MX$0.00</div>
          <ul class="breakdown" id="detalleLista"></ul>
        </div>
        <div class="actions">
          <button type="button" class="btn-outline" id="btnPdf">Descargar PDF</button>
          <a class="btn" id="btnWhats" href="#" target="_blank" rel="noopener">Enviar por WhatsApp</a>
        </div>
        <div class="hint" style="margin-top:8px;">Los extras con “trabajo especial” requieren cotización directa con el artesano.</div>
      </div>
    </form>
  </main>
  <footer class="site-footer">
    <div class="container">
      <p>by: Empresa — Todos los derechos reservados</p>
    </div>
  </footer>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script>
    // --- LÓGICA DE PRECIOS Y CÁLCULO ---
    function money(n) { return (n || 0).toLocaleString('es-MX', { style: 'currency', currency: 'MXN' }); }

    // Base de precios
    const BASE_PRICES = {
      monturas: {
        esqueleto_cola_pato: { cuero: 18000, cuerno_toro: 3000, inox_blanco: 3500, inox_pavonado: 4500, fierro_aluminio: 9000, fierro_plata: 'trabajo especial' },
        esqueleto_basto_cuadrado: { cuero: 20000, cuerno_toro: 3000, inox_blanco: 3500, inox_pavonado: 4500, fierro_aluminio: 9000, fierro_plata: 'trabajo especial' },
        cantinas_redondas_basto_mediano: { cuero: 22000, cuerno_toro: 3000, inox_blanco: 3500, inox_pavonado: 4500, fierro_aluminio: 9000, fierro_plata: 'trabajo especial' },
        cantinas_cuadradas_basto_mediano: { cuero: 22000, cuerno_toro: 3000, inox_blanco: 3500, inox_pavonado: 4500, fierro_aluminio: 9000, fierro_plata: 'trabajo especial' },
        cantinas_redondas_basto_grande: { cuero: 25000, cuerno_toro: 3000, inox_blanco: 3500, inox_pavonado: 4500, fierro_aluminio: 9000, fierro_plata: 'trabajo especial' },
        cantinas_cuadradas_basto_grande: { cuero: 25000, cuerno_toro: 3000, inox_blanco: 3500, inox_pavonado: 4500, fierro_aluminio: 9000, fierro_plata: 'trabajo especial' }
      },
      argollas_tapa: 1000,
      estribos_tapadera: 1500,
      extras: {
        carona: {
          cola_pato: 800, basto_cuadrado: 1000,
          redondas_basto_mediano: 1200, cuadradas_basto_mediano: 1200,
          redondas_basto_grande: 1500, cuadradas_basto_grande: 1500
        },
        zarape: { sencillo: 900, fino: 3500 },
        cincha: 1200,
        cuarta: 500,
        jaquima: 2800,
        cinturon: 900
      }
    };

    // --- DOM ---
    const form = document.getElementById('cotizadorForm');
    const medidaFuste = document.getElementById('medidaFuste');
    const medidaError = document.getElementById('medidaError');
    const cueraje = document.getElementById('cueraje');
    const herrajeEstilo = document.getElementById('herrajeEstilo');
    const argollasTapa = document.getElementById('argollasTapa');
    const arcTipoHint = document.getElementById('arcTipoHint');
    const argTapaHint = document.getElementById('argTapaHint');
    const btnWhats = document.getElementById('btnWhats');
    const btnPdf = document.getElementById('btnPdf');
    const precioTotalEl = document.getElementById('precioTotal');
    const detalleLista = document.getElementById('detalleLista');

    // --- FUNCIONES ---
    function isTrabajoEspecialFuste(medida) {
      return parseFloat(medida) >= 16.5;
    }
    function isFusteMenor14(medida) {
      return parseFloat(medida) < 14;
    }
    function getSelected(name) {
      const checked = form.querySelector(`[name="${name}"]:checked`);
      return checked ? checked.value : '';
    }
    function calcular() {
      let items = [];
      let total = 0;
      let trabajoEspecial = false;
      let cotizarDirecto = [];

      // Fuste
      const fusteEstilo = form.fusteEstilo.value;
      const medida = form.medidaFuste.value;
      let fusteDesc = `Fuste: ${fusteEstilo === 'saldivar' ? 'Saldívar' : 'Buchón'} - ${medida}"`;
      let fusteError = "";

      if (isTrabajoEspecialFuste(medida)) {
        fusteError = 'Fustes de 16.5" o más se cotizan aparte por mensaje directo (trabajo especial).';
        trabajoEspecial = true;
      }
      if (isFusteMenor14(medida)) {
        fusteDesc += " (costo incluido)";
      }
      items.push({ text: fusteDesc, price: 0 });
      medidaError.style.display = fusteError ? 'block' : 'none';
      medidaError.textContent = fusteError;

      // Cueraje + Herraje
      const cuerajeVal = cueraje.value;
      let cuerajeLabel = cueraje.options[cueraje.selectedIndex].textContent;
      let herraje = herrajeEstilo.value;
      let basePrice = BASE_PRICES.monturas[cuerajeVal]?.cuero || 0;
      let herrajeDelta = 0;
      let herrajeText = "";
      let argTapaDisp = false;
      let argTapaLabel = "";
      let isHerrajeEspecial = false;

      // Herraje
      switch (herraje) {
        case "cuero": herrajeDelta = 0; herrajeText = "Herraje: cuero"; break;
        case "cuerno_toro": herrajeDelta = 3000; herrajeText = "Herraje: cuerno de toro (+$3,000)"; break;
        case "inox_blanco": herrajeDelta = 3500; herrajeText = "Herraje: acero inoxidable blanco (+$3,500)"; argTapaDisp = true; break;
        case "inox_pavonado": herrajeDelta = 4500; herrajeText = "Herraje: acero inoxidable pavonado (+$4,500)"; argTapaDisp = true; break;
        case "fierro_aluminio": herrajeDelta = 9000; herrajeText = "Herraje: fierro incrustado de aluminio (+$9,000)"; argTapaDisp = true; break;
        case "fierro_plata": herrajeDelta = 0; herrajeText = "Herraje: fierro incrustado de plata (trabajo especial)"; argTapaDisp = true; isHerrajeEspecial = true; trabajoEspecial = true; break;
      }

      // Argollas de tapa
      let argTapa = argollasTapa.checked;
      let argTapaPrecio = 0;
      if (argTapa) {
        if (["inox_blanco","inox_pavonado","fierro_aluminio","fierro_plata"].includes(herraje)) {
          argTapaPrecio = BASE_PRICES.argollas_tapa;
          argTapaLabel = "Con argollas de tapa";
        } else {
          argTapa = false; // No permitido
        }
      }
      argollasTapa.disabled = !argTapaDisp;
      argTapaHint.textContent = argTapaDisp ? "" : "Solo disponible con herraje de acero inoxidable, fierro de aluminio o plata.";

      // Trabajo especial herraje
      if (isHerrajeEspecial) {
        herrajeText += ". Se cotiza directo con el artesano.";
        cotizarDirecto.push("Herraje de plata");
      }

      // Precio cueraje+herraje
      let cuerajePrecio = isHerrajeEspecial ? 0 : (basePrice + herrajeDelta + argTapaPrecio);
      let detalleHerraje = `${cuerajeLabel} con ${herrajeText}` + (argTapa ? ", argollas de tapa (+$1,000)" : "");

      items.push({ text: detalleHerraje, price: cuerajePrecio });

      // Cliente manda fuste
      if (form.clienteMandaFuste.checked) {
        items.push({ text: "El cliente envía su fuste", price: -1000 });
      }

      // Arciones
      let arcEstilo = getSelected("arcEstilo");
      let arcTipo = getSelected("arcTipo");
      // Solo esqueleto_cola_pato y esqueleto_basto_cuadrado pueden escoger tipo, el resto rectas
      let tipoFijo = !["esqueleto_cola_pato", "esqueleto_basto_cuadrado"].includes(cuerajeVal);
      if (tipoFijo) {
        arcTipo = "recta";
        arcTipoHint.textContent = "Solo las monturas esqueleto tienen opción de arción tipo sudadera. Para el resto, solo rectas.";
      } else {
        arcTipoHint.textContent = "";
      }
      let arcDesc = `Arciones: ${arcEstilo === "doble" ? "Dobles" : "Sencillas"} - ${arcTipo === "sudadera" ? "Sudadera" : "Rectas"}`;
      items.push({ text: arcDesc, price: 0 });

      // Estribos
      let estribos = getSelected("estribos");
      let estrPrice = estribos === "tapadera" ? BASE_PRICES.estribos_tapadera : 0;
      let estrDesc = estribos === "tapadera" ? "Estribos de tapadera (+$1,500)" : "Estribos abiertos (incluidos)";
      items.push({ text: estrDesc, price: estrPrice });

      // ---- EXTRAS ----
      // Carona
      let caronaVal = form.carona.value;
      if (caronaVal && BASE_PRICES.extras.carona[caronaVal]) {
        let price = BASE_PRICES.extras.carona[caronaVal];
        items.push({ text: `Carona (${caronaVal.replace(/_/g, ' ')})`, price });
      }
      // Zarape
      let zarape = getSelected("zarape");
      if (zarape && zarape !== "") {
        let price = BASE_PRICES.extras.zarape[zarape];
        items.push({ text: `Zarape ${zarape === "fino" ? "fino" : "sencillo"}`, price });
      }
      // Cincha
      if (form.cincha.checked) {
        let medida = form.cinchaMedida.value ? ` (${form.cinchaMedida.value}cm)` : "";
        items.push({ text: "Cincha" + medida, price: BASE_PRICES.extras.cincha });
      }
      // Cuarta
      if (form.cuarta.checked) items.push({ text: "Cuarta estándar", price: BASE_PRICES.extras.cuarta });
      // Jaquima
      if (form.jaquima.checked) items.push({ text: "Jáquima / Bozalillo", price: BASE_PRICES.extras.jaquima });
      // Cinturón
      if (form.cinturon.checked) {
        let talla = form.cinturonTalla.value ? ` (talla ${form.cinturonTalla.value})` : "";
        items.push({ text: "Cinturón de piel cosido a mano" + talla, price: BASE_PRICES.extras.cinturon });
      }

      // Extras a cotizar directo
      [
        {id:"hebilla", label:"Hebilla del cinturón"},
        {id:"espuelas", label:"Espuelas"},
        {id:"machete", label:"Machete"},
        {id:"freno", label:"Freno"},
        {id:"cuchillo", label:"Cuchillo"}
      ].forEach(item => {
        if (form[item.id].checked) {
          items.push({ text: item.label + " (trabajo especial, cotizar con artesano)", price: 0 });
          cotizarDirecto.push(item.label);
        }
      });

      // Mostrar resumen y total
      detalleLista.innerHTML = items.map(it => `<li><span>${it.text}</span><strong>${it.price !== 0 ? money(it.price) : (trabajoEspecial && it.price === 0 ? "trabajo especial" : "$0")}</strong></li>`).join("");
      total = items.reduce((s, it) => s + (typeof it.price === "number" ? it.price : 0), 0);
      precioTotalEl.textContent = money(total);

      // WhatsApp
      const phone = '527226128347';
      let resumenTxt = items.map(it => `${it.text}: ${typeof it.price === "number" ? money(it.price) : it.price}`).join('\n');
      let text = encodeURIComponent(
        `Hola, te comparto la cotización:\n\n${resumenTxt}\n\nTotal: ${money(total)}\n\n${cotizarDirecto.length ? 'Requiere cotización directa de: ' + cotizarDirecto.join(', ') : ''}`
      );
      btnWhats.href = `https://wa.me/${phone}?text=${text}`;
    }

    // --- EVENTOS ---
    form.addEventListener('input', calcular);
    form.addEventListener('change', calcular);

    // PDF
    btnPdf.addEventListener('click', async () => {
      const area = document.getElementById('cotizacionResumen');
      const canvas = await html2canvas(area, { scale: 2 });
      const imgData = canvas.toDataURL('image/png');
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF('p', 'mm', 'a4');
      const pageWidth = pdf.internal.pageSize.getWidth();
      const pageHeight = pdf.internal.pageSize.getHeight();
      const margin = 10;
      const imgWidthPx = canvas.width;
      const imgHeightPx = canvas.height;
      const maxW = pageWidth - margin * 2;
      const maxH = pageHeight - margin * 2;
      const ratio = Math.min(maxW / imgWidthPx, maxH / imgHeightPx);
      const imgW = imgWidthPx * ratio;
      const imgH = imgHeightPx * ratio;
      const x = (pageWidth - imgW) / 2;
      const y = (pageHeight - imgH) / 2;
      pdf.addImage(imgData, 'PNG', x, y, imgW, imgH);
      const now = new Date();
      const pad = (n) => String(n).padStart(2, '0');
      const stamp = `${now.getFullYear()}${pad(now.getMonth()+1)}${pad(now.getDate())}-${pad(now.getHours())}${pad(now.getMinutes())}`;
      pdf.save(`cotizacion-montura-${stamp}.pdf`);
    });

    // Inicializar
    calcular();
  </script>
</body>
</html>
